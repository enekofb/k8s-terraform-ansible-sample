---
- name: Set kubectl endpoint
  shell: "kubectl config set-cluster {{ kubernetes_cluster_name }} \
          --certificate-authority={{ certificate_path }}/ca.pem \
          --embed-certs=true \
          --server=https://{{ kubernetes_api_endpoint }}:{{ kubernetes_api_endpoint_port }}
          --kubeconfig=/var/lib/kubelet/bootstrap.kubeconfig"
  become: true

- name: Set kubectl credentials
  shell: "kubectl config set-credentials kubelet-bootstrap \
          --token e6ffc61adfe129f0accae337add9645f \
          --kubeconfig=/var/lib/kubelet/bootstrap.kubeconfig"
  become: true

- name: Set kubectl default context
  shell: "kubectl config set-context default-context \
         --cluster={{ kubernetes_cluster_name }} \
         --user=kubelet-bootstrap \
         --kubeconfig=/var/lib/kubelet/bootstrap.kubeconfig"
  become: true


- name: Switch kubectl to default context
  shell: "kubectl config use-context default-context \
         --kubeconfig=/var/lib/kubelet/bootstrap.kubeconfig"
  become: true